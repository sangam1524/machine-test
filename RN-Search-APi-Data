import {
  StyleSheet,
  Text,
  View,
  FlatList,
  ActivityIndicator,
  TextInput,
} from 'react-native';
import { useEffect, useState } from 'react';

export default function App() {
  let [data, setData] = useState(null);
  let [filteredData, setFilteredData] = useState([]);
  let [input, setInput] = useState('');
  let [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchData();
  }, []);

  async function fetchData() {
    setLoading(true);
    try {
      let res = await fetch('https://jsonplaceholder.typicode.com/posts');
      let data = await res.json();
      setLoading(false);
      console.log(data);
      setData(data);
      setFilteredData(data);
    } catch (error) {
      console.log('error --->', error);
      setLoading(false);
    }
  }

  function refetchData() {
    fetchData();
  }

  function handleSearch(text) {
  setInput(text);
  if (text === '') {
    setFilteredData(data); 
    return;
  }
  const filtered = data.filter(item =>
    item.title.toLowerCase().includes(text.toLowerCase())
  );
  setFilteredData(filtered);
}

  return (
    <View style={styles.container}>
      <Text>Here is list</Text>
      <TextInput style={styles.input} onChangeText={handleSearch} value={input} />
      {loading ? (
        <ActivityIndicator size="large" color="#00ff00" />
      ) : (
        <FlatList
          data={filteredData}
          keyExtractor={(item) => item.id.toString()}
          renderItem={({ item }) => {
            return (
              <View style={{ flexDirection: 'row', marginVertical: 10 }}>
                <Text>{item.id}.</Text>
                <Text>{item.title}</Text>
              </View>
            );
          }}
          refreshing={loading} // <-- show loader when refreshing
          onRefresh={refetchData}
        />
      )}
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#ecf0f1',
    padding: 8,
    marginTop: 50,
  },
  input: {
    borderWidth: 1,
    borderRadius: 12,
  },
});
